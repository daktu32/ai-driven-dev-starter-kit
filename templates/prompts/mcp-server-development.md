# MCP (Model Context Protocol) サーバー開発プロンプト

## プロジェクト概要

このプロジェクトは、Model Context Protocol (MCP) に準拠したサーバー実装です。MCPは、AIモデルがツール、リソース、プロンプトにアクセスするための標準化されたプロトコルです。

## 技術スタック

- **言語**: TypeScript
- **ランタイム**: Node.js (18.0.0以上)
- **フレームワーク**: @modelcontextprotocol/sdk
- **テスト**: Jest
- **リンター**: ESLint
- **フォーマッター**: Prettier
- **ロガー**: Winston

## プロジェクト構造

```
mcp-server/
├── src/                      # ソースコード
│   ├── index.ts              # エントリーポイント
│   ├── server.ts             # MCPサーバー実装
│   ├── handlers/             # リクエストハンドラー
│   ├── tools/                # ツール実装
│   ├── resources/            # リソース実装
│   ├── prompts/              # プロンプト実装
│   ├── types/                # 型定義
│   └── utils/                # ユーティリティ
├── tests/                    # テストコード
├── config/                   # 設定ファイル
└── docs/                     # ドキュメント
```

## 開発ガイドライン

### コーディング規約

1. **TypeScript厳密モード**: 常に `strict: true` で開発
2. **エラーハンドリング**: すべての非同期処理で適切なエラー処理を実装
3. **型安全性**: `any` 型の使用を避け、適切な型定義を使用
4. **モジュール性**: 機能ごとに独立したモジュールとして実装
5. **テスタビリティ**: 依存性注入を活用してテスト可能な設計

### MCP仕様準拠

1. **プロトコルバージョン**: MCP v1.0に準拠
2. **メッセージフォーマット**: JSON-RPC 2.0
3. **エラーコード**: MCP標準エラーコードを使用
4. **セキュリティ**: 認証・認可の実装

### ツール実装

新しいツールを実装する際の手順:

1. `src/tools/` に新しいツールクラスを作成
2. `Tool` インターフェースを実装
3. 入力パラメータの検証を実装
4. エラーハンドリングを適切に実装
5. 単体テストを作成

例:
```typescript
export class MyTool implements Tool {
  name = 'my-tool';
  description = 'ツールの説明';
  
  inputSchema = z.object({
    param1: z.string(),
    param2: z.number().optional()
  });
  
  async execute(params: unknown) {
    const validated = this.inputSchema.parse(params);
    // 実装
  }
}
```

### リソース実装

リソースは外部データやAPIへのアクセスを管理:

1. 読み取り専用アクセスを基本とする
2. ページネーションのサポート
3. フィルタリング機能の実装
4. キャッシング戦略の検討

### プロンプト実装

プロンプトテンプレートの実装:

1. 変数置換のサポート
2. コンテキスト管理
3. バージョン管理
4. 多言語対応の考慮

## テスト戦略

1. **単体テスト**: 各モジュールの独立したテスト
2. **統合テスト**: MCPプロトコル準拠の確認
3. **E2Eテスト**: 実際のクライアントとの接続テスト
4. **カバレッジ目標**: 80%以上

## デプロイメント

1. **コンテナ化**: Dockerfileの提供
2. **環境変数管理**: dotenvを使用
3. **ログ管理**: 構造化ログの実装
4. **監視**: ヘルスチェックエンドポイント

## セキュリティ考慮事項

1. **入力検証**: すべての入力データの検証
2. **レート制限**: DoS攻撃の防止
3. **認証**: APIキーまたはトークンベース認証
4. **CORS**: 適切なCORS設定
5. **秘密情報管理**: 環境変数での管理

## パフォーマンス最適化

1. **非同期処理**: Promise/async-awaitの適切な使用
2. **バッチ処理**: 複数リクエストの効率的な処理
3. **キャッシング**: 頻繁にアクセスされるデータのキャッシュ
4. **接続プーリング**: 外部サービスへの接続管理

## ドキュメント化

1. **API仕様**: OpenAPI/Swagger形式
2. **README**: セットアップと使用方法
3. **JSDoc**: コード内ドキュメント
4. **変更履歴**: CHANGELOGの維持

## 継続的改善

1. **フィードバック収集**: ユーザーからのフィードバック
2. **パフォーマンス監視**: メトリクスの収集と分析
3. **定期的な依存関係更新**: セキュリティパッチの適用
4. **コードレビュー**: プルリクエストでのレビュー必須